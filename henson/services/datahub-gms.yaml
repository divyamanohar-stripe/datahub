service_name: datahub-gms
availability_tier: A300
repo: stripe-private-oss-forks/datahub
description: "DataHub Generalized Metadata service"
contact:
  responsible_team: schema-and-query
  slack_channel: data-platform
kubernetes:
  template: "henson/kube/datahub-gms.sky"
container_images:
  - artifact_name: datahub-image
    ecr:
      repository: stripe/stripe-private-oss-forks/datahub
deploy:
  clusters:
    - northwest
  rollout:
    stages:
      - kubernetes:
          function_name: canary
        clusters:
          - northwest
        stage_advance:
          abort_unhealthy_after: 120
          wait_duration: 60
          healthchecks:
            - consul_health:
                service_name: datahub-gms
      - kubernetes:
          function_name: main
        clusters:
          - northwest
        stage_advance:
          abort_unhealthy_after: 120
          wait_duration: 60
          healthchecks:
            - consul_health:
                service_name: datahub-gms
# TODO: In a subsequent pass setup autodeploys + more deploy notifications
announce:
  announce_channels:
    - channel: datahub-bots
# TODO: add links to dashboard & runbooks when we have them
# http://go/outbound-acls
inbound_config:
  inbound_listeners:
    # Services
    - consul_service: datahub-gms
      allowed_clients:
        - host_type: airflow
        - host_type: airflowds
        - host_type: airflowicp
        - host_type: airflowretention
        - host_type: airflowweb
        - host_type: datahub
        - host_type: mydev
        - host_type: mydata
  outbound_services:
    - service_name: schema-registry
      mtls_authorities:
        - schemaregistry
