fragment dataflowIconFields on DataPlatform {
    properties {
        type
        displayName
        logoUrl
    }
}

fragment groupRunResults on DataProcessInstanceResult {
    runs {
        execution {
            logicalDate
            startDate
            endDate
        }
        state(limit: 1) {
            status
            result {
                resultType
            }
        }
        externalUrl
        slaInfo {
            slaDefined
            errorStartedBy
            errorFinishedBy
            warnStartedBy
            warnFinishedBy
        }
    }
}

fragment groupSearchResultFields on Entity {
    urn
    ... on Dataset {
        type
        urn
        name
        runs: runs(input: $runInput, direction: OUTGOING) {
            ...groupRunResults
        }

    }
    ... on DataJob {
        type
        urn
        properties {
            name
        }
        dataFlow {
            platform {
                ...dataflowIconFields
            }
        }
        runs: runs(input: $runInput) {
            ...groupRunResults
        }

    }

}


fragment groupSearchResults on SearchResults {
    searchResults {
        entity {
            ...groupSearchResultFields
        }
    }
}

query getGroupRunMetrics($input: SearchAcrossEntitiesInput!, $runInput: DataProcessInstanceInput!) {
    searchAcrossEntities(input: $input) {
        ...groupSearchResults
    }
}


fragment groupOwnershipFields on Ownership {
    owners {
        owner {
            ... on CorpGroup {
                urn
                type
                name
                properties {
                    displayName
                    email
                }
                editableProperties {
                    description
                    slack
                }
            }
        }
    }
}

fragment groupRelationshipFields on EntityWithRelationships {
    ... on DataJob {
        urn
        type
        properties {
            name
        }
        dataFlow {
            platform {
                ...dataflowIconFields
            }
        }
        ownership {
            ...groupOwnershipFields
        }
    }
    ... on Dataset {
        name
        type
        ownership {
            ...groupOwnershipFields
        }
    }
}

fragment groupFullLineageResults on EntityLineageResult {
    relationships {
        type
        entity {
            ...groupRelationshipFields
        }
    }
}


fragment teamSearchResultFields on Entity {
    urn
    ... on Dataset {
        downstream: lineage(input: { direction: DOWNSTREAM, start: 0, count: 100 }) {
            ...groupFullLineageResults
        }
    }
    ... on DataJob {
        downstream: lineage(input: { direction: DOWNSTREAM, start: 0, count: 100 }) {
            ...groupFullLineageResults
        }
    }
}


fragment teamSearchResults on SearchResults {
    count
    total
    searchResults {
        entity {
            ...teamSearchResultFields
        }
    }
}

query getDownstreamTeams($input: SearchAcrossEntitiesInput!) {
    searchAcrossEntities(input: $input) {
        ...teamSearchResults
    }
}

fragment groupSearchResultFieldsIncidents on Entity {
    ... on Incident {
        id
        urn
        properties {
            name
            description
            summary
            severity
            state
            openedAt
        }

    }
}


fragment groupSearchResultsIncidents on SearchResults {
    searchResults {
        entity {
            ...groupSearchResultFieldsIncidents
        }
    }
}

query getGroupIncidents($input: SearchAcrossEntitiesInput!) {
    searchAcrossEntities(input: $input) {
        ...groupSearchResultsIncidents
    }
}